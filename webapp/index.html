<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimal-ui, initial-scale=0.7">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="mobile-web-app-status-bar-style" content="black-translucent">
        <style>
            .panel, .profile, .offer-view, .box {
                border: 2px solid rgb(96 139 168);
                background: rgb(96 139 168);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .wallet {
                border: 2px solid rgb(96 139 168);
                background: rgb(96 139 168);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .menu {
                position: fixed; 
                width: 97%;
                left: 1%;
                bottom:3%;
                height: 130px;
            }

            .profile, .offer-view {
                border: none;
            }

            .profile-group, .offer-info-group {
                border: none;
                padding: 10px
            }

            .scrollable {
                overflow-y: scroll;
                height: 65%;
                 
                -ms-overflow-style: none;  /* Internet Explorer 10+ */
                scrollbar-width: none;  /* Firefox */
            }

            .scrollable::-webkit-scrollbar { 
                display: none;  /* Safari and Chrome */
            }

            object {
                width: 100%;
                pointer-events: none;
            }

            .wide-panel {
                border: 2px solid black;
                width: 99%;
                justify-content:space-between
            }

            .offer-info {
                width: 99%;
            }

            .offer-preview {
                width: 99%;
                overflow-x: hidden;
                position: relative;
            }

            .contract-info {
                margin-left: 10px;
                width: 99%;
                justify-content:left
            }

            .button, .offer-button {
                background: none;
                padding: 2;
                display: flex;

            }

            .button {
                width: 10rem;
                height: 10rem;
            }

            hr {
                border: 6px solid black;
            }

            html, body {
                overflow-x: hidden;
                overflow-y: hidden;
            }

            body {
                position: relative;
                overflow-y: hidden;
                max-height: 98%;
            }

            pre {
                font-weight:700;
                font-size: large;
            }

            .copy-button {
                margin: -5;
                width: 2rem;
                height: 1.5rem;
            }

            .tag-button, .add-interest-button, .send-funds-button {
                border-radius: 12px;
                background-color: #04AA6D;
                border: none;
                color: white;
                padding: 10px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
            }

            .add-interest-button, .send-funds-button {
                border-radius: 1px;
                margin: 0px 0px;
                padding: 5px 10px;
            }

            .offer-button {
                width: 5rem;
                height: 5rem;
            }

            .add-interest, .send-funds-amount, .txfee, .send-funds-address {
                font-weight:300;
                font-size: 16px;
                border:0px;
                outline: none;
                width: 50%;
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                color: #4b545f;
                background: #fff;
                font-family: Open Sans,Verdana;
                padding: 5px 15px;
                margin: 0px 0px;
                -webkit-transition: all 0.1s ease-in-out;
                -moz-transition: all 0.1s ease-in-out;
                -ms-transition: all 0.1s ease-in-out;
                -o-transition: all 0.1s ease-in-out;
                transition: all 0.1s ease-in-out;
                background-color: grey
            }

            .add-interest {
                width: 20%;
            }

            .send-funds-amount {
                width: 80px 
            }

            .txfee {
                width: 15ch;
            }


            .slidecontainer {
                width: 100%; /* Width of the outside container */
            }


            .slider-color {
                width: 100%;
                height: 15px;
                border-radius: 5px;
                background: #d3d3d3;
                outline: none;
                opacity:0.7;
                -webkit-transition: opacity .15s ease-in-out;
                transition: opacity .15s ease-in-out;
            }
            
            .slider-color:hover {
                opacity:1;
            }
            
            .slider-color::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 25px;
                height: 25px;
                border-radius: 50%;
                background: #04AA6D;
                cursor: pointer;
            }
                
            .slider-color::-moz-range-thumb {
                width: 25px;
                height: 25px;
                border: 0;
                border-radius: 50%;
                background: #04AA6D;
                cursor: pointer;
            }
      
              
        </style>
    </head>
    <body style="background-color:black;">

        <pre class="wallet">
<div>Balance: <font color="cyan" id="wallet-balance">0,000 sat</font>
Address: <font color="blue" id="wallet-address">.................................</font> <img src="./assets/copy.svg" class="copy-button" onclick="window.copyAddressToBuffer()"></div></pre>

        <div id="matching"class="scrollable" ><p id="loading" style="color: #00FF00; font-size: 24px; font-family: monospace">Loading...</p></div>
        <div id="contracts" class="scrollable" style="display:none"></div>
        <div id="profile" class="scrollable profile" style="display:none" class="profile">
            <div class="profile-group">
                <pre><h3>Oracle Filter</h3></pre>
                <pre>Minimum PoW-distance (oracle - reports): </pre>
                <div class="slidecontainer">
                    <input type="range" min="-5" max="20" value="0" class="slider-color" id="oracle-strength">
                </div>
                <pre id="ranktext">0</pre>
            </div>
            <hr>
            <div class="profile-group">
                <pre><h3>Interests:</h3></pre>
                <div id="tags">
                    <button class="tag-button" id="tag-sports" onclick="window.removeInterest('sports')">sports</button>
                    <button class="tag-button" id="tag-world" onclick="window.removeInterest('world')">world</button>
                </div>
                <pre><input id="interest" class="add-interest"> <button id="add-interest-button" class="add-interest-button">+</button></pre>
                <input id="confirm_orders" type="checkbox" name="confirm">
                <label for="confirm"> ask order confirmation</label><br>
            </div>
            <hr>
            <div class="profile-group">
                <pre>txfee: <input id="txfee" class="txfee" type="number" value="1000"> sats </pre>
                <pre><h3>Withdraw funds:</h3> amount: <input id="send-funds-amount" class="send-funds-amount" type="number" value="0"><br><br> address: <input id="send-funds-address" class="send-funds-address" value="n3W8YyK59F6vQe34uQ8n835L627k2J"> <button id="send-funds-button" class="send-funds-button">Send</button></pre>

                
            </div>
            <hr>
            <div class="profile-group">
                <button class="send-funds-button" onclick="window.matching.reset();">Reset Profile</button>
                <pre>peers: <span id="peers">[]</span></pre>

            </div>
        </div>

        <div id="offer" class="scrollable offer-view" style="display:none">
            <div class="offer-info-group">
                <h4>Offer Terms: </h4>
                <div id="terms"></div>
            </div>
            <hr>
            <div class="offer-info-group">
                <h4>Oracle Details:</h4>
                <div id="oracle">PubKey: ABCDEF<br>Name: Wolfram</div>
            </div>
            <hr>
            <div class="offer-info-group">
            <h4>Capabilities Info:</h4>
            <div id="capability">PubKey: ABCDEF</div>
            </div>
            <hr>

            <div class="offer-info-group">
                <h4>Malleability Reports:</h4>
                <div id="reports">NONE</div>
            </div>
            <hr>
            
        </div>

        <pre></pre>
       

        <div id="panel" class="panel menu">

            <div onclick="switchTab('contracts')">
                <svg class="button" id="contracts_svg" fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g id="Circle_List" data-name="Circle List">
                        <g>
                        <path d="M20.438,6.062h-9a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/>
                        <path d="M20.438,12.5h-9a.5.5,0,0,1,0-1h9a.5.5,0,0,1,0,1Z"/>
                        <path d="M20.438,18.935h-9a.5.5,0,1,1,0-1h9a.5.5,0,0,1,0,1Z"/>
                        <path d="M5.562,8.062a2.5,2.5,0,1,1,2.5-2.5A2.5,2.5,0,0,1,5.562,8.062Zm0-4a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,5.562,4.062Z"/>
                        <path d="M5.562,14.5a2.5,2.5,0,1,1,2.5-2.5A2.5,2.5,0,0,1,5.562,14.5Zm0-4a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,5.562,10.5Z"/>
                        <path d="M5.562,20.938a2.5,2.5,0,1,1,2.5-2.5A2.5,2.5,0,0,1,5.562,20.938Zm0-4a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,5.562,16.938Z"/>
                        </g>
                    </g>
                </svg>
            </div>

            <div onclick="switchTab('matching')">
                <svg class="button" width="800px" height="800px" viewBox="-3 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    
                    <title>fire-2</title>
                    
                    <defs>

                    </defs>
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                            <g id="matching_svg" sketch:type="MSLayerGroup" transform="translate(-415.000000, -411.000000)" fill="black">
                                <path d="M428.5,441 C422.148,441 417,435.641 417,429.625 C417,428.228 417.031,427.094 418,426 C417.895,426.634 419.397,432.055 424.305,431.771 C424.092,427.652 422.978,417.561 428.152,414.073 C427.695,419.557 429.038,426.924 435.029,428 C434.686,425.801 434.727,422.143 436.267,421.467 C436.433,424.836 438.924,426.914 438.924,430.152 C438.924,436.016 433.251,441 428.5,441 L428.5,441 Z M437.905,417.953 C433.52,419.203 432.717,422.748 433,425 C429.872,421.322 430,417.093 430,411 C419.968,414.783 422.301,425.688 422,429 C419.477,426.935 419,422 419,422 C416.336,423.371 415,427.031 415,430 C415,437.18 420.82,443 428,443 C435.18,443 441,437.18 441,430 C441,425.733 437.867,423.765 437.905,417.953 L437.905,417.953 Z" id="fire-2" sketch:type="MSShapeGroup">

                    </path>
                        </g>
                    </g>
                </svg>
            </div>

            <div onclick="switchTab('profile')">
               <svg id="profile_obj" class = "button" width="800px" height="800px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="style=stroke">
                    <g id="profile_svg" fill="black">
                    <path id="profile_top" fill-rule="evenodd" clip-rule="evenodd" d="M12 2.75C9.92893 2.75 8.25 4.42893 8.25 6.5C8.25 8.57107 9.92893 10.25 12 10.25C14.0711 10.25 15.75 8.57107 15.75 6.5C15.75 4.42893 14.0711 2.75 12 2.75ZM6.75 6.5C6.75 3.6005 9.1005 1.25 12 1.25C14.8995 1.25 17.25 3.6005 17.25 6.5C17.25 9.3995 14.8995 11.75 12 11.75C9.1005 11.75 6.75 9.3995 6.75 6.5Z"/>
                    <path id="profile_bottom" fill-rule="evenodd" clip-rule="evenodd" d="M4.25 18.5714C4.25 15.6325 6.63249 13.25 9.57143 13.25H14.4286C17.3675 13.25 19.75 15.6325 19.75 18.5714C19.75 20.8792 17.8792 22.75 15.5714 22.75H8.42857C6.12081 22.75 4.25 20.8792 4.25 18.5714ZM9.57143 14.75C7.46091 14.75 5.75 16.4609 5.75 18.5714C5.75 20.0508 6.94924 21.25 8.42857 21.25H15.5714C17.0508 21.25 18.25 20.0508 18.25 18.5714C18.25 16.4609 16.5391 14.75 14.4286 14.75H9.57143Z"/>
                    </g>
                    </g>
                </svg>
            </div>
        </div>

        

        <script src="../mega-peers.min.js" type="module"></script>
        <script src="https://unpkg.com/darkreader@4.9.105/darkreader.js"></script> 
        
        <script>

setTimeout(() => {
    if(!window.offersFound){
        //location.reload()
    }
}, 4000)

const defaultClr = "gray"
const accentColor = "yellow" 
window.highlightOrders = "cyan"  

    const conf = {
    brightness: 80,
    contrast: 200,
    sepia: 80
}

const recolor = () => {
    try {

        if (document.getElementById("matching_svg") &&
        document.getElementById("profile_svg") &&
        document.getElementById("contracts_svg")) {

            
            DarkReader.setFetchMethod(window.fetch)

            document.getElementById("contracts_svg").setAttribute("fill", defaultClr)
            document.getElementById("matching_svg").setAttribute("fill", accentColor)
                
            document.getElementById("matching_svg").style.filter = "brightness(2.0)"
            document.getElementById("contracts_svg").style.filter = "brightness(3.7)"
            document.getElementById("profile_svg").style.filter = "brightness(3.7)"

            document.getElementById("profile_svg").setAttribute("fill", defaultClr)
                
            
            DarkReader.enable(conf);
            //clearInterval(color)
        }

    } catch {

    }
    
}

try {
    recolor()
} catch {

}

document.getElementById("matching_svg").addEventListener("load", () => {
    document.getElementById("matching_svg").setAttribute("fill", "brown")
})
            
const switchTab = (tabname) => {
    document.getElementById("matching").style.display = "none"
    document.getElementById("contracts").style.display = "none"
    document.getElementById("profile").style.display = "none"
    document.getElementById("offer").style.display = "none"

    try {

        document.getElementById("contracts_svg").setAttribute("fill", defaultClr)
        document.getElementById("matching_svg").setAttribute("fill", defaultClr)
        
        document.getElementById("profile_svg").setAttribute("fill", defaultClr)
        
        document.getElementById(tabname+"_svg").setAttribute("fill", accentColor)
    } catch (e) {
        console.log(e)
    }
        

    document.getElementById(tabname).style.display = "block"
    
}

//await on orgiginal init does not work; browser bug
const initWebapp = new Promise(resolve => { 
    cancel = setInterval(() => {
        if (window.pool && window.matching && window.matching.loadProfile) {
            clearInterval(cancel)
            resolve()
        }
    }, 100)
});


(async () => { //jsdom doesn't support modules..we simulate one

    await initWebapp 

    setTimeout(() => {
        window.matching.collectOffers(model.profile)                  
        setInterval(() => window.progressOffers(), 3000)
        window.matching.collectQuestions(model.profile)    
    }, 4000)


    setInterval(() => {
        try {
            document.getElementById("peers").innerText = "" + window.peerlist.length
        } catch {

        }    
    }, 1000)

    window.model = {
        profile: undefined,
        offers: [],
        contracts: []
    }

    setInterval(async () => {
        window.model.profile = await window.matching.loadProfile()
        window.document.dispatchEvent(new Event('init-model'));

    }, 300)
    
    try {
        document.getElementById("oracle-strength").onchange = () => {
            window.model.profile.minOracleRank = document.getElementById("oracle-strength").value
            document.getElementById("ranktext").innerText = "" + window.model.profile.minOracleRank
        }
    } catch (e) {
        console.error(e)
    }

    try {
        document.getElementById("txfee").onchange = () => {
            window.model.profile.txfee = document.getElementById("txfee").value   
        }
    } catch (e) {
        console.error(e)
    }

    document.getElementById("send-funds-button").onclick = () => {
        const amount = document.getElementById("send-funds-amount").value
        const address = document.getElementById("send-funds-address").value
        const tx = matching.takeWinnings(amount, address, window.model.profile.txfee)
        navigator.clipboard.writeText(tx)
        alert("Copied TxBody To Clipboard!")
    }

    window.pickOrGenerateOffer = async (pick) => {
        if (pick) {
            try {
                return await window.matching.pickOffer(model.profile)
            } catch (e) {
                console.error(e)
                return await window.matching.generateOffer(model.profile)
            }
            
        } else {
            return await window.matching.generateOffer(model.profile)
        }
    }

    window.document.dispatchEvent(new Event('init-offer-controller'));

    window.removeInterest = (tag) => {
        window.model.profile.tags = window.model.profile.tags.filter(x => x != tag)
        document.getElementById(`tag-${tag}`).remove()
    }



    document.getElementById("add-interest-button").onclick = () => {
        const tag = document.getElementById("interest").value
        const btn = document.createElement("button")
        btn.className="tag-button"
        btn.id = `tag-${tag}`
        btn.innerText = tag;
        window.model.profile.tags.push(tag)
        btn.onclick = () => {
            removeInterest(tag)
        }
        document.getElementById("tags").appendChild(btn)

    }

    window.createOfferInfo = (offer, isTentative = false) => {
        const offerInfo = document.createElement("div")
        function chunkString(sStr, iLen) {
            return [...sStr].reduce((aChunks, sChar, iIdx) => ( 
            aChunks.push(iIdx % iLen === 0 ? sChar : aChunks.pop() + sChar), aChunks), [])
        }
        const offerQuestion = document.createElement("span")
        offerQuestion.style = ""
        offerQuestion.innerHTML = `<pre><span color="purple" style = "display:inline-block; max-width: 15ch; overflow: hidden; text-overflow: ellipsis;">${offer.question}</span></pre>`
        
        //textFit(offerQuestion.getElementById("question")) 
        const offerBet = document.createElement("pre")
        offerBet.innerHTML = `<font color = "grene">${offer.bet[0]}:${offer.bet[1]} sat</font>`


        const oracle = document.createElement("pre")
        oracle.innerHTML = `<font color="brown">${offer.oracles[0].oracle.slice(0, 15) + "..." + (offer.oracles.length > 1 ? " +" : "")}</font>`
        const oracleEndpoint = document.createElement("pre")
        oracleEndpoint.innerHTML = `<font color="brown">${offer.oracles[0].endpoint.replace("http://", "").replace("https://", "").slice(0, 15) + (offer.oracles.length > 1 ? "+" : "")}</font>`


        offerInfo.appendChild(offerQuestion)
        offerInfo.appendChild(offerBet)
        offerInfo.appendChild(oracle)
        offerInfo.appendChild(oracleEndpoint)

        if (offer.status && !isTentative) {
            const rename = (status) => {
                if (status === "oracle committed") {
                    return "accepted, oracle committed"
                } else {
                    return status
                }
            }
            const offerStatus = document.createElement("pre")
            offerStatus.innerHTML = `<font color="white">${rename(offer.status)}</font>`
            offerInfo.appendChild(offerStatus)
            if (offer.role === "acceptor" && !offer.patyBetsOn || offer.role === "originator" && offer.patyBetsOn) {
                offerBet.innerHTML = `<font color = "grene">[u bet ${offer.bet[0]} sat on YES]:${offer.bet[1]}</font>`
            } else {
                offerBet.innerHTML = `<font color = "grene">${offer.bet[0]}:[u bet ${offer.bet[1]} sat on NO]</font>`
            }
            oracle.innerHTML = `<font color="brown">${offer.oracles[0].oracle.slice(0, 30) + "..." + (offer.oracles.length > 1 ? " +" : "")}</font>`
            oracleEndpoint.innerHTML = `<font color="brown">${offer.oracles[0].endpoint.replace("http://", "").replace("https://", "").slice(0, 30) + (offer.oracles.length > 1 ? "+" : "")}</font>`
                

        }
        return offerInfo
    }

    window.renderOfferPreview = (where, offer, append = true) => {
        const downArrowSvg = document.createElement("img")
        downArrowSvg.src = "./assets/down.svg"
        downArrowSvg.className = "offer-button"
        downArrowSvg.onclick = () => {
            renderOfferDetails(offer)
        }

        const yesSvg = document.createElement("img")
        yesSvg.src = "./assets/yes.svg"
        yesSvg.className = "offer-button"
        yesSvg.onclick = () => {
            let confirmed = undefined
            if (document.getElementById("confirm_orders").checked) {
                confirmed = confirm("Bet " + offer.bet[1] + " sat against '" + offer.question + "'")
            } else {
                confirmed = true
            }
            if (confirmed) {
                console.log(offer.status)
                    if (offer.role === 'initiator') {
                        window.matching.broadcastOffer(offer)
                    } else {
                        if (!offer.betOn) {
                            window.matching.acceptOffer(offer)
                        } else {
                            console.log("Needs opposite position to accept")
                        }
                    }
                    
                }
        }


        const noSvg = document.createElement("img")
        noSvg.src = "./assets/no.svg"
        noSvg.className = "offer-button"
        noSvg.onclick = () => {
            let confirmed = undefined
            if (document.getElementById("confirm_orders").checked) {
                confirmed = confirm("Bet " + offer.bet[1] + " sat against '" + offer.question + "'")
            } else {
                confirmed = true
            }          
            if (confirmed) {
                if (offer.role === 'initiator') {
                    window.matching.broadcastOffer(offer)
                } else {
                    if (offer.betOn) {
                        window.matching.acceptOffer(offer)
                    } else {
                        console.log("Needs opposite position to accept")
                    }
                    
                }  
            }     
        }
            
        const updateSvg = document.createElement("img")
        updateSvg.src = "./assets/cycle.svg"
        updateSvg.className = "offer-button"
        
        const offerInfo = createOfferInfo(offer, true)
        offerInfo.className = "offer-info"
        

        const panel = document.createElement("div")
        panel.className = "panel offer-preview"
        panel.appendChild(updateSvg)
        panel.appendChild(offerInfo)

        if (offer.role !== 'initiator' && offer.betOn) {
            yesSvg.style = "filter: grayscale(1)"
        }
        panel.appendChild(yesSvg)

        if (offer.role !== 'initiator' && !offer.betOn) {
            noSvg.style = "filter: grayscale(1)"
        } 
        panel.appendChild(noSvg)

        
        panel.appendChild(noSvg)
        panel.appendChild(downArrowSvg)

        
        updateSvg.onclick = async () => {
            const newOffer = await pickOrGenerateOffer(Math.random() < 0.5)
            const panel2 = renderOfferPreview(where, newOffer, false)
            where.replaceChild(panel2, panel)
        }
        
        if (append) {
            where.appendChild(panel)
        }
        
        return panel

    }

    const maxMatching = 3
    window.offersFound = 0

    const camcel = setInterval(async () => {
        if (offersFound >= maxMatching - 1) {
            clearInterval(camcel)
        }
        try {
            const offer = await window.matching.generateOffer(model.profile)
            offersFound++
            window.model.offers.push(offer)
            renderOfferPreview(document.getElementById("matching"), offer)
            document.getElementById("loading").innerText = ""
            
        } catch {

        }

    }, 500)

    window.copyAddressToBuffer = () => {
        navigator.clipboard.writeText(window.address)
        alert('Copied to Clipboard')
    }

    setInterval(async () => {
        try {
            const address =  window.address.length > 20 ? 
            window.address.slice(0, 30) + "..."//"n3W8YyK59F6vQe34uQ8n835L627k2J"
            : window.address

            try {
                const stats = await (await fetch("https://mempool.space/testnet/api/address/" + window.address)).json()
                const bal = stats.chain_stats.funded_txo_sum - stats.chain_stats.spent_txo_sum
                const balance = bal === 0 ? "0,000 sat" : bal.toLocaleString() + " sat"
                document.getElementById("wallet-balance").innerText = balance

            } catch {
                const balance = "0,000 sat"

            }
            
        
            document.getElementById("wallet-address").innerText = address
            

        } catch {

        }
    }, 1000)
    
    window.renderOfferDetails = (offer) => {
        switchTab("offer")
        const offerInfo = createOfferInfo(offer)
        offerInfo.className = "offer-info"
        const terms = document.getElementById("terms")
        terms.innerHTML = ""
        terms.appendChild(offerInfo)
    }

    window.renderContractPreview = (where, contract) => {
        const downArrowSvg = document.createElement("img")
        downArrowSvg.src = "./assets/down.svg"
        downArrowSvg.className = "offer-button"
        downArrowSvg.onclick = () => {
            renderOfferDetails(contract)
        }

        const removeSvg = document.createElement("img")
        removeSvg.src = "./assets/remove.svg"
        removeSvg.className = "offer-button"
        removeSvg.onclick = () => {
            window.matching.removeOrder(contract.id)
        }

        const offerInfo = createOfferInfo(contract)
        offerInfo.className = "contract-info"
        const panel = document.createElement("div")
        panel.className = "panel wide-panel"
        panel.appendChild(removeSvg)

        panel.appendChild(offerInfo)

        

        panel.appendChild(downArrowSvg)
        where.appendChild(panel)
    }

    

    model.contracts.forEach(contract => {
        renderContractPreview(document.getElementById("contracts"), contract)
    })

    setInterval(async () => {
        try {
        
            const orders = await window.matching.listOrders(20)
            if (JSON.stringify(orders) === JSON.stringify(model.contracts)) {
                return
            }

            document.getElementById("contracts").innerHTML = "";
            model.contracts = orders
            orders.forEach(contract => {
                renderContractPreview(document.getElementById("contracts"), contract)
            })

            if (model.contracts.length > 0) {
                try {
                    let i = 0
                    const before = document.getElementById("contracts_svg").getAttribute("fill")
                    const beforeFilter = document.getElementById("contracts_svg").style.filter = document.getElementById("contracts_svg").style.filter
                    const blink = setInterval(() => {
                        i++
                        document.getElementById("contracts_svg").setAttribute("fill", i % 2 == 0? before : highlightOrders)
                        document.getElementById("contracts_svg").style.filter = i % 2 == 0?  "brightness(1.5)" : "brightness(1.5)"
                        if (i > 5) {
                            document.getElementById("contracts_svg").style.filter = beforeFilter
                            document.getElementById("contracts_svg").setAttribute("fill", before)
                            clearInterval(blink)
                        }
                    }, 300)
                    
                } catch {

                }
                
            }
        } catch {

        }
        
    }, 100)

    
})();







        </script>
    </body>
</html>